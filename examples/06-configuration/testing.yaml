# NAQ Configuration - Testing Environment
# Generated by NAQ CLI
#
# This configuration is optimized for testing with:
# - Minimal services enabled (events and scheduler disabled)
# - Single worker for predictable test execution
# - Warning-level logging to reduce noise
# - Short TTLs for quick test cleanup
# - Fast timeouts to fail tests quickly

nats:
  servers:
    - ${NAQ_NATS_URL:nats://localhost:4222}
  client_name: naq-test-client
  max_reconnect_attempts: 3  # Fail fast in tests
  reconnect_time_wait: 1.0   # Quick retries
  connection_timeout: 5.0    # Short timeout
  drain_timeout: 10.0        # Quick shutdown
  flush_timeout: 2.0
  ping_interval: 30.0
  max_outstanding_pings: 1
  auth: null
  tls:
    enabled: false
    cert_file: null
    key_file: null
    ca_file: null

queues:
  default: test_queue
  prefix: naq_test
  configs:
    test_queue:
      ack_wait: 10    # Quick timeout for tests
      max_deliver: 2  # Fail fast
      max_ack_pending: 10

workers:
  concurrency: 1      # Single worker for predictable tests
  heartbeat_interval: 5  # Quick heartbeats
  ttl: 30            # Short TTL
  max_job_duration: 60  # 1 minute max for tests
  shutdown_timeout: 5   # Quick shutdown
  pools: {}

scheduler:
  enabled: false     # Disabled for most tests
  lock_ttl: 10
  lock_renew_interval: 5
  max_failures: 1    # Fail immediately
  scan_interval: 0.5

events:
  enabled: false     # Disabled to simplify tests
  batch_size: 1      # Immediate processing if enabled
  flush_interval: 0.1
  max_buffer_size: 10
  storage_url: null
  subject_prefix: naq.test.jobs.events
  stream:
    name: NAQ_TEST_JOB_EVENTS
    max_age: "1h"     # Very short retention
    max_bytes: "10MB"
    replicas: 1
  filters:
    exclude_heartbeats: true
    min_job_duration: 0

results:
  ttl: 60            # 1 minute TTL for tests
  cleanup_interval: 30  # Frequent cleanup
  kv_bucket: naq_test_results

serialization:
  job_serializer: pickle  # Faster than JSON for tests
  compression: false      # No compression for speed
  json:
    encoder: json.JSONEncoder
    decoder: json.JSONDecoder

logging:
  level: WARNING     # Reduce noise in test output
  format: text       # Human readable for debugging
  file: null         # Log to stdout
  max_size: 10MB
  backup_count: 1
  to_file_enabled: false

environments:
  testing:
    name: testing
    overrides:
      logging.level: WARNING
      events.enabled: false
      scheduler.enabled: false
      workers.concurrency: 1
      results.ttl: 60
      
  unit_test:
    name: unit_test
    overrides:
      logging.level: ERROR
      events.enabled: false
      scheduler.enabled: false
      workers.concurrency: 1
      results.ttl: 30
      
  integration_test:
    name: integration_test
    overrides:
      logging.level: INFO
      events.enabled: true
      scheduler.enabled: true
      workers.concurrency: 2
      results.ttl: 300