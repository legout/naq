# NAQ Configuration - Production Environment
# Generated by NAQ CLI
#
# This configuration is optimized for production with:
# - High worker concurrency for performance
# - Structured JSON logging for monitoring
# - Large event batches for efficiency
# - Multiple NATS servers for high availability
# - Longer timeouts and retries for reliability

nats:
  servers:
    - ${NAQ_NATS_URL:nats://nats-1:4222}
    - ${NAQ_NATS_BACKUP_1:nats://nats-2:4222}
    - ${NAQ_NATS_BACKUP_2:nats://nats-3:4222}
  client_name: ${NAQ_CLIENT_NAME:naq-prod-client}
  max_reconnect_attempts: 10  # More retries for production
  reconnect_time_wait: 5.0    # Longer wait for stability
  connection_timeout: 30.0    # Longer timeout
  drain_timeout: 60.0         # Graceful shutdown
  flush_timeout: 10.0
  ping_interval: 60.0         # More frequent health checks
  max_outstanding_pings: 3
  auth:
    username: ${NATS_USER}
    password: ${NATS_PASS}
  tls:
    enabled: ${NAQ_TLS_ENABLED:false}
    cert_file: ${NAQ_TLS_CERT_FILE}
    key_file: ${NAQ_TLS_KEY_FILE}
    ca_file: ${NAQ_TLS_CA_FILE}

queues:
  default: ${NAQ_DEFAULT_QUEUE:prod_queue}
  prefix: ${NAQ_QUEUE_PREFIX:naq_prod}
  configs:
    # High-priority queue with faster timeouts
    urgent:
      ack_wait: 30
      max_deliver: 5
      max_ack_pending: 1000
    # Background tasks with longer timeouts
    background:
      ack_wait: 300
      max_deliver: 3
      max_ack_pending: 500
    # Email queue with moderate settings
    email:
      ack_wait: 120
      max_deliver: 5
      max_ack_pending: 2000

workers:
  concurrency: ${NAQ_WORKER_CONCURRENCY:50}  # High concurrency for production
  heartbeat_interval: 30  # Less frequent in production
  ttl: 120               # Longer TTL
  max_job_duration: 7200 # 2 hours max
  shutdown_timeout: 60   # Graceful shutdown
  pools:
    # High-priority worker pool
    priority:
      concurrency: 20
      queues: ["urgent", "critical"]
    # Background processing pool
    background:
      concurrency: 10
      queues: ["background", "cleanup"]
    # Email processing pool  
    email:
      concurrency: 15
      queues: ["email", "notifications"]
    # Reports and analytics pool
    reports:
      concurrency: 5
      queues: ["reports", "analytics"]

scheduler:
  enabled: true
  lock_ttl: 60           # Longer lock TTL for production
  lock_renew_interval: 30
  max_failures: 10       # More retries before giving up
  scan_interval: 5.0     # Less frequent scanning

events:
  enabled: true
  batch_size: 500        # Large batches for efficiency
  flush_interval: 1.0    # Frequent flushing for monitoring
  max_buffer_size: 50000 # Large buffer
  storage_url: ${NAQ_EVENT_STORAGE_URL}  # Separate event storage
  subject_prefix: ${NAQ_EVENT_SUBJECT_PREFIX:naq.prod.jobs.events}
  stream:
    name: ${NAQ_EVENT_STREAM_NAME:NAQ_PROD_JOB_EVENTS}
    max_age: "30d"       # 30 days retention
    max_bytes: "10GB"    # Large storage
    replicas: 3          # High availability
  filters:
    exclude_heartbeats: true
    min_job_duration: 100  # Only log jobs > 100ms

results:
  ttl: ${NAQ_RESULT_TTL:1209600}  # 14 days
  cleanup_interval: 3600          # Hourly cleanup
  kv_bucket: ${NAQ_RESULT_BUCKET:naq_prod_results}

serialization:
  job_serializer: ${NAQ_JOB_SERIALIZER:pickle}
  compression: ${NAQ_COMPRESSION:true}  # Enable compression for production
  json:
    encoder: ${NAQ_JSON_ENCODER:json.JSONEncoder}
    decoder: ${NAQ_JSON_DECODER:json.JSONDecoder}

logging:
  level: ${NAQ_LOG_LEVEL:INFO}
  format: json          # Structured logging for production
  file: ${NAQ_LOG_FILE:/var/log/naq/naq.log}
  max_size: ${NAQ_LOG_MAX_SIZE:1GB}
  backup_count: ${NAQ_LOG_BACKUP_COUNT:10}
  to_file_enabled: ${NAQ_LOG_TO_FILE:true}

environments:
  production:
    name: production
    overrides:
      logging.level: INFO
      logging.format: json
      events.batch_size: 500
      events.flush_interval: 1.0
      workers.concurrency: 50
      workers.heartbeat_interval: 30
      scheduler.scan_interval: 5.0
      results.ttl: 1209600  # 14 days
      
  staging:
    name: staging
    overrides:
      logging.level: DEBUG
      workers.concurrency: 20
      events.batch_size: 100
      results.ttl: 259200  # 3 days
      
  monitoring:
    name: monitoring
    overrides:
      events.filters.exclude_heartbeats: false
      events.filters.min_job_duration: 0
      logging.level: DEBUG