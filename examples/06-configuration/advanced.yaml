# NAQ Configuration - Advanced Example
# Generated by NAQ CLI
#
# This configuration demonstrates all available options and features:
# - Multiple NATS servers with authentication and TLS
# - Complex worker pool configurations
# - Queue-specific settings
# - Advanced event logging with filtering
# - Environment-specific overrides
# - Custom serialization settings

nats:
  # Multiple servers for high availability
  servers:
    - nats://primary.example.com:4222
    - nats://secondary.example.com:4222
    - nats-tls://secure.example.com:4222
  client_name: naq-advanced-client
  
  # Connection settings
  max_reconnect_attempts: 15
  reconnect_time_wait: 3.0
  connection_timeout: 20.0
  drain_timeout: 45.0
  flush_timeout: 8.0
  ping_interval: 90.0
  max_outstanding_pings: 3
  
  # Authentication (choose one method)
  auth:
    # Method 1: Username/Password
    username: ${NATS_USERNAME}
    password: ${NATS_PASSWORD}
    
    # Method 2: Token (alternative - comment out username/password above)
    # token: ${NATS_TOKEN}
  
  # TLS Configuration
  tls:
    enabled: true
    cert_file: /etc/naq/tls/client.crt
    key_file: /etc/naq/tls/client.key
    ca_file: /etc/naq/tls/ca.crt

queues:
  default: main_processing_queue
  prefix: myapp_prod
  
  # Queue-specific configurations
  configs:
    # High-priority urgent tasks
    urgent:
      ack_wait: 30         # 30 second timeout
      max_deliver: 5       # Retry up to 5 times
      max_ack_pending: 1000
    
    # Background processing tasks
    background:
      ack_wait: 600        # 10 minute timeout for long tasks
      max_deliver: 3
      max_ack_pending: 200
    
    # Email sending queue
    email:
      ack_wait: 120        # 2 minute timeout
      max_deliver: 5
      max_ack_pending: 2000
    
    # Report generation
    reports:
      ack_wait: 1800       # 30 minute timeout for reports
      max_deliver: 2       # Don't retry reports many times
      max_ack_pending: 50
    
    # Image processing queue
    images:
      ack_wait: 300        # 5 minute timeout
      max_deliver: 3
      max_ack_pending: 100

workers:
  # Default worker settings
  concurrency: 25
  heartbeat_interval: 20
  ttl: 90
  max_job_duration: 3600   # 1 hour maximum
  shutdown_timeout: 45
  
  # Specialized worker pools
  pools:
    # High-priority tasks pool
    urgent_pool:
      concurrency: 10
      queues: ["urgent", "critical_alerts"]
    
    # Background processing pool
    background_pool:
      concurrency: 5
      queues: ["background", "cleanup", "maintenance"]
    
    # Email processing pool
    email_pool:
      concurrency: 8
      queues: ["email", "notifications", "newsletters"]
    
    # Report generation pool (CPU intensive)
    reports_pool:
      concurrency: 3
      queues: ["reports", "analytics", "exports"]
    
    # Image processing pool (memory intensive)
    images_pool:
      concurrency: 4
      queues: ["images", "thumbnails", "video_processing"]

scheduler:
  enabled: true
  lock_ttl: 45
  lock_renew_interval: 20
  max_failures: 8
  scan_interval: 2.0

events:
  enabled: true
  batch_size: 250
  flush_interval: 3.0
  max_buffer_size: 25000
  
  # Separate NATS cluster for events (optional)
  storage_url: nats://events.example.com:4222
  subject_prefix: myapp.jobs.events
  
  # JetStream configuration
  stream:
    name: MYAPP_JOB_EVENTS
    max_age: "60d"         # 60 days retention
    max_bytes: "50GB"      # 50GB storage limit
    replicas: 3            # 3 replicas for high availability
  
  # Event filtering
  filters:
    exclude_heartbeats: true
    min_job_duration: 250  # Only log jobs that take > 250ms

results:
  ttl: 2592000           # 30 days
  cleanup_interval: 7200 # Every 2 hours
  kv_bucket: myapp_job_results

serialization:
  job_serializer: json   # Use JSON for better debugging
  compression: true      # Enable compression for large payloads
  json:
    # Custom JSON encoder/decoder for special types
    encoder: myapp.serializers.CustomJSONEncoder
    decoder: myapp.serializers.CustomJSONDecoder

logging:
  level: INFO
  format: json           # Structured logging
  file: /var/log/naq/naq.log
  max_size: 500MB
  backup_count: 15
  to_file_enabled: true

# Environment-specific overrides
environments:
  # Development environment
  development:
    name: development
    overrides:
      logging.level: DEBUG
      logging.format: text
      workers.concurrency: 3
      events.batch_size: 10
      events.flush_interval: 1.0
      results.ttl: 86400     # 1 day in dev
      nats.servers[0]: nats://localhost:4222
      nats.auth: null        # No auth in dev
      nats.tls.enabled: false
  
  # Staging environment
  staging:
    name: staging
    overrides:
      logging.level: DEBUG
      workers.concurrency: 15
      events.batch_size: 100
      results.ttl: 604800    # 1 week in staging
      scheduler.scan_interval: 3.0
  
  # Production environment  
  production:
    name: production
    overrides:
      logging.level: INFO
      logging.format: json
      workers.concurrency: 25
      events.batch_size: 500
      events.flush_interval: 1.0
      scheduler.scan_interval: 5.0
      results.ttl: 2592000   # 30 days in production
  
  # Load testing environment
  load_test:
    name: load_test
    overrides:
      logging.level: WARNING
      workers.concurrency: 50
      events.batch_size: 1000
      events.flush_interval: 0.5
      results.ttl: 3600      # 1 hour for load tests
      scheduler.enabled: false
  
  # Monitoring/debugging environment
  debug:
    name: debug
    overrides:
      logging.level: TRACE
      logging.format: text
      events.filters.exclude_heartbeats: false
      events.filters.min_job_duration: 0
      workers.heartbeat_interval: 5
      scheduler.scan_interval: 0.5